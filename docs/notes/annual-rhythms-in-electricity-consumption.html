<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Henrik Korsgaard - Annual rhythms in electricity consumption?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../css/styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../" class="navbar-brand navbar-brand-logo">
    <img src="../public/images/henrik-transparent.png" alt="" class="navbar-logo">
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../notes.html">
 <span class="menu-text">NOTES</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../things.html">
 <span class="menu-text">THINGS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html">
 <span class="menu-text">RESEARCH</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">ABOUT</span></a>
  </li>  
</ul>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Annual rhythms in electricity consumption?</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Data reflect the world and the systems that generate it. A lot of the patterns that can be identified using various analytic methods are not surprising, but quite obvious if looking at the practices producing the data. In many ways, it makes more sense to talk about rhythms and routines when considering patterns in data. The patterns are weak or strong signals, or residue or traces of the people and practices, and not isolated patterns only visible in the data. This note is part about me learning to use D3 to visualize data and part of me trying to figure out if our electricity consumption follows the annual changes in daylight.</p>
<section id="data-on-electricity-consumption" class="level3">
<h3 class="anchored" data-anchor-id="data-on-electricity-consumption">Data on electricity consumption</h3>
<p>In Denmark, anyone can download data on their electricity consumption from <a href="https://eloverblik.dk/welcome">El Overblik</a>. You can download data for your household meter with a resolution from the year, over month and day, to an hour and even every 15 minutes in some cases. We start with a dataset of my household’s electricity consumption since November 2017 per month. Some wrangling is required to reduce the object and format the data.</p>
<script type="text/javascript" src="../js/suncalc.js"></script>
<div class="cell" data-output="all">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1" data-startfrom="15" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 14;"><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Loading our data file</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"/public/data/el-consumption-days-all.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span><span class="kw">true</span>})<span class="op">.</span><span class="fu">then</span>(raw <span class="kw">=&gt;</span> {</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> lat <span class="op">=</span> <span class="fl">56.16</span><span class="op">,</span> long<span class="op">=</span><span class="fl">10.20</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//We want to simplify our objects and translate the values into appropriate formats.</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">//We keep the date and the value</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    raw <span class="op">=</span> raw<span class="op">.</span><span class="fu">filter</span>(o <span class="kw">=&gt;</span> {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> str <span class="op">=</span> o[<span class="st">"Fra_dato"</span>]<span class="op">.</span><span class="fu">substring</span>(<span class="dv">6</span><span class="op">,</span><span class="dv">10</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> o[<span class="st">"Type"</span>] <span class="op">===</span> <span class="st">"Tidsserie"</span> <span class="op">&amp;&amp;</span> str <span class="op">!=</span> <span class="st">"2017"</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> days <span class="op">=</span> {}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    raw <span class="op">=</span> raw<span class="op">.</span><span class="fu">map</span>(o <span class="kw">=&gt;</span> {</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> dstr <span class="op">=</span> o[<span class="st">"Fra_dato"</span>]<span class="op">.</span><span class="fu">replace</span>(<span class="st">" 00:00:00"</span><span class="op">,</span> <span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">"-"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Gonna remove the leap year. </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(dstr[<span class="dv">1</span>] <span class="op">===</span> <span class="st">"02"</span> <span class="op">&amp;&amp;</span> dstr[<span class="dv">0</span>] <span class="op">===</span> <span class="st">"29"</span>){</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="vs">`</span><span class="sc">${</span><span class="dv">2022</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>dstr[<span class="dv">1</span>]<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>dstr[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="op">!</span>days[date]){</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Create object for date</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Including data on the hours of the day</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> sun <span class="op">=</span> SunCalc<span class="op">.</span><span class="fu">getTimes</span>(<span class="kw">new</span> <span class="bu">Date</span>(date)<span class="op">,</span> lat<span class="op">,</span>long)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> day_hs <span class="op">=</span> sun<span class="op">.</span><span class="at">sunset</span><span class="op">.</span><span class="fu">getHours</span>() <span class="op">-</span> sun<span class="op">.</span><span class="at">sunrise</span><span class="op">.</span><span class="fu">getHours</span>()</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            <span class="co">//day object to return</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            days[date] <span class="op">=</span> {<span class="dt">date</span><span class="op">:</span> date<span class="op">,</span> <span class="dt">kwhs_min</span><span class="op">:</span><span class="dv">100</span><span class="op">,</span> <span class="dt">kwhs_max</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">kwhs_values</span><span class="op">:</span>[]<span class="op">,</span><span class="dt">kwhs_median</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">kwhs_q_lower</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">kwhs_q_upper</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">day_hs</span><span class="op">:</span>day_hs}</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> v <span class="op">=</span> <span class="kw">typeof</span> o[<span class="st">"Mængde"</span>] <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> <span class="pp">parseInt</span>(o[<span class="st">"Mængde"</span>]) <span class="op">:</span> o[<span class="st">"Mængde"</span>]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">//adding kwhs consumption to the value array and calculate min/max</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        days[date]<span class="op">.</span><span class="at">kwhs_values</span><span class="op">.</span><span class="fu">push</span>(v)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        days[date]<span class="op">.</span><span class="at">kwhs_min</span> <span class="op">=</span> v <span class="op">&lt;</span> days[date]<span class="op">.</span><span class="at">kwhs_min</span> <span class="op">?</span> v <span class="op">:</span> days[date]<span class="op">.</span><span class="at">kwhs_min</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        days[date]<span class="op">.</span><span class="at">kwhs_max</span> <span class="op">=</span> v <span class="op">&gt;</span> days[date]<span class="op">.</span><span class="at">kwhs_max</span> <span class="op">?</span> v <span class="op">:</span> days[date]<span class="op">.</span><span class="at">kwhs_max</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Convert days Object to Array</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    raw <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(days)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Sorting dates because the order is messy after conversion from object to array</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    raw<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> {</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a[<span class="st">"date"</span>] <span class="op">&gt;</span> b[<span class="st">"date"</span>]</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Calculating medians</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    raw <span class="op">=</span> raw<span class="op">.</span><span class="fu">map</span>(o <span class="kw">=&gt;</span> {</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        o<span class="op">.</span><span class="at">kwhs_median</span> <span class="op">=</span> d3<span class="op">.</span><span class="fu">median</span>(o<span class="op">.</span><span class="at">kwhs_values</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        o<span class="op">.</span><span class="at">kwhs_q_lower</span> <span class="op">=</span> d3<span class="op">.</span><span class="fu">quantile</span>(o<span class="op">.</span><span class="at">kwhs_values</span><span class="op">,</span> <span class="fl">0.25</span>)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        o<span class="op">.</span><span class="at">kwhs_q_upper</span> <span class="op">=</span> d3<span class="op">.</span><span class="fu">quantile</span>(o<span class="op">.</span><span class="at">kwhs_values</span><span class="op">,</span> <span class="fl">0.75</span>)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> o</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> raw</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="annual-electricity-consumption" class="level3">
<h3 class="anchored" data-anchor-id="annual-electricity-consumption">Annual electricity consumption</h3>
<p>I wanted to plot our annual consumption in a way that followed the calendar year and carried across into the new year. The annual radial visualization in figure <a href="#fig-radial-annual">Figure&nbsp;1</a> below captures our energy consumption from 2018 to 2022 and daylight hours from the calendar year 2022.</p>
<div class="cell" data-output="all">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2" data-startfrom="84" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 83;"><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co">//Chart appropriated from https://observablehq.com/@d3/radial-area-chart</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>radial_chart <span class="op">=</span> {</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">900</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">900</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> innerRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">5</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> outerRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xAxis <span class="op">=</span> g <span class="kw">=&gt;</span> g</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g"</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">data</span>(x<span class="op">.</span><span class="fu">ticks</span>())</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">each</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">=</span> DOM<span class="op">.</span><span class="fu">uid</span>(<span class="st">"month"</span>))</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="vs">              M</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">pointRadial</span>(<span class="fu">x</span>(d)<span class="op">,</span> innerRadius)<span class="sc">}</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="vs">              L</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">pointRadial</span>(<span class="fu">x</span>(d)<span class="op">,</span> outerRadius)<span class="sc">}</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="vs">            `</span>))</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="at">id</span>)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">datum</span>(d <span class="kw">=&gt;</span> [d<span class="op">,</span> d3<span class="op">.</span><span class="at">timeMonth</span><span class="op">.</span><span class="fu">offset</span>(d<span class="op">,</span> <span class="dv">1</span>)])</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> ([a<span class="op">,</span> b]) <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="vs">              M</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">pointRadial</span>(<span class="fu">x</span>(a)<span class="op">,</span> innerRadius<span class="op">-</span><span class="dv">15</span>)<span class="sc">}</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="vs">              A</span><span class="sc">${</span>innerRadius<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>innerRadius<span class="sc">}</span><span class="vs"> 0,0,1 </span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">pointRadial</span>(<span class="fu">x</span>(b)<span class="op">,</span> innerRadius<span class="op">-</span><span class="dv">15</span>)<span class="sc">}</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="vs">            `</span>))</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">"textPath"</span>)</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"startOffset"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"xlink:href"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="at">href</span>)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>(d3<span class="op">.</span><span class="fu">timeFormat</span>(<span class="st">"%B"</span>))))</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yAxis <span class="op">=</span> g <span class="kw">=&gt;</span> g</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="fu">y</span>(<span class="dv">0</span>)))</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g"</span>)</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">data</span>(y<span class="op">.</span><span class="fu">ticks</span>()<span class="op">.</span><span class="fu">reverse</span>())</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> y))</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="op">-</span><span class="fu">y</span>(d))</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.5em"</span>)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#fff"</span>)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">text</span>((x<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>x<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="sc">}${</span>i <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="st">" kwhs"</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">clone</span>(<span class="kw">true</span>)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">y</span>(d))</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">selectAll</span>(<span class="kw">function</span>() {<span class="cf">return</span> [<span class="kw">this</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">previousSibling</span>]<span class="op">;</span> })</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">clone</span>(<span class="kw">true</span>)</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"currentColor"</span>)</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"none"</span>)))</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">31</span>)])</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>])</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([d3<span class="op">.</span><span class="fu">min</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">kwhs_min</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">kwhs_max</span>)<span class="op">+</span><span class="dv">2</span>])</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([innerRadius<span class="op">,</span> outerRadius])</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> area <span class="op">=</span> d3<span class="op">.</span><span class="fu">areaRadial</span>()</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">angle</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">date</span>))</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">lineRadial</span>()</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">angle</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">date</span>))</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="op">-</span>width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span>height <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)<span class="op">;</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"lightyellow"</span>)</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> area</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">innerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(<span class="dv">0</span>))</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">outerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">day_hs</span>))</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        (data))</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"lightsteelblue"</span>)</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> area</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">innerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">kwhs_min</span>))</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">outerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">kwhs_max</span>))</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        (data))<span class="op">;</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"steelblue"</span>)</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> area</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">innerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">kwhs_q_lower</span>))</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">outerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">kwhs_q_upper</span>))</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>        (data))<span class="op">;</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"median"</span>)</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"darkblue"</span>)</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> line</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">radius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">kwhs_median</span>))</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>        (data))<span class="op">;</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(xAxis)<span class="op">;</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(yAxis)<span class="op">;</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> legend <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate("</span><span class="op">+</span>(<span class="op">-</span>width<span class="op">/</span><span class="dv">2</span>)<span class="op">+</span><span class="st">","</span> <span class="op">+</span> (<span class="op">-</span>height<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">16</span>)</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">2</span>)</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">0</span>)</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"lightsteelblue"</span>)</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">27</span>)</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"1em"</span>)</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>(<span class="st">"Minimum and maximum consumption 2018 - 2022"</span>)</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">2</span>)</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">25</span>)</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"steelblue"</span>)</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">27</span>)</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"1em"</span>)</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>(<span class="st">"Upper and lower quartiles consumtion (kwhs)"</span>)</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">2</span>)</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">50</span>)</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"darkblue"</span>)</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">27</span>)</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">50</span>)</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"1em"</span>)</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>(<span class="st">"Median consumption (kwhs)"</span>)</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="fl">2.5</span>)</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">75</span>)</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"grey"</span>)</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"lightyellow"</span>)</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">27</span>)</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">75</span>)</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"1em"</span>)</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>(<span class="st">"Daylight hours"</span>)</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-radial-annual" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Annual household electricity consumption and daylight hours</figcaption><p></p>
</figure>
</div>
</div>
<p>I did the visualisation with the <em>hypothesis</em> that our electricity consumption would correlate with the available daylight. With the bright summer nights, we need less light and as the days get shorter towards the winter we need more. This assumes that a significant amount of our electricity is consumed by sources that somehow map to this rhythm. Lights are one source, but indoor entertainment (gaming, streaming, television, etc.) would also increase during the winter.</p>
<p>It is easy to observe the rhythm of the daylight changes in <a href="#fig-radial-annual">Figure&nbsp;1</a>, but the correlation with energy consumption is less obvious. Or rather, the erratic nature of the energy data obscures whatever might be there. It looks like the summer months are slightly below the 10 kwhs line, with the spring and fall months sitting on the line, and the winter months moving slightly above the 10 kwhs line. Turns out that when computing the correlation coefficient (r=0.243, see below), then there is hardly any correlation between daylight and electricity consumption data.</p>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"></script>
<div class="cell" data-output="all">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3" data-startfrom="279" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 278;"><span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>correlation_coeffecient <span class="op">=</span> {</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> kwhs_array <span class="op">=</span> days<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span>{</span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">kwhs</span></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> daylight_array <span class="op">=</span> days<span class="op">.</span><span class="fu">map</span>( d <span class="kw">=&gt;</span>{</span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">daylight</span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> correlation <span class="op">=</span> simplestats<span class="op">.</span><span class="fu">sampleCorrelation</span>(kwhs_array<span class="op">,</span>daylight_array)</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correlation</span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<p>While dissapointed that the visualisation does not show a clear pattern, this also hightligt the benefits of visualising the data. While the correlation coefficient tell me that there is no correlation between daylight and electricity consumption, the visualisation (and making it) has a lot of additional benefits:</p>
<ul>
<li>I am learning useful information about the particular data from crafting the visualisation. Information that is useful for future experiments and visualisations.</li>
<li>The visualisation and data forces me to reflect on my hypothesis and look for alternative explanations</li>
<li>The visualisation provide hints and information useful for speculating about explanations on the relationship between consumption and annual patterns.</li>
</ul>
</section>
<section id="so-why-does-our-annual-electricity-consumption-not-correlate-with-available-daylight" class="level3">
<h3 class="anchored" data-anchor-id="so-why-does-our-annual-electricity-consumption-not-correlate-with-available-daylight">So, why does our annual electricity consumption not correlate with available daylight?</h3>
<p>The hypothesis assumes that a significant amount of our electricity consumption goes to sources that decrease with an increase in available daylight and increase when it gets darker outside during the winther. That would mostly be electrical lights and indoor entertainment. First, I do not think that lights account for a significant amount of our consumption. This would go to refriguation, laundry and cooking. On top of that, most of our indoor lighting is LED based which consume only a few watts per unit per hour and our use of entertainment likely only changes marginally from summer to winther. I still play computer games and we still stream during the summer.</p>
<p>This pose an interesting question. We are often told that private consumers should <a href="https://energypost.eu/residential-energy-use-interventions-that-alter-daily-habits-vs-top-down-regulations/">change habits</a> and <a href="https://nrgi.dk/privat/energivenlig/8-lette-spareraad-til-underholdning/">implement various micro-initiatives</a> as part of solutions toward the climate and energy crisis. While some initatives do work, the savings seem minimal. My guestimate is that we can properly optimize our consumption to save a couple of kilowatts per day at most. A lot of our consumption is not something we can change at the moment. We still need a freezer and refrigerator, and we need to cook meals. A lot of larger initiatives do not make economic sense. So, is it even possible to optimize household consumption in a meaningful way so it contributes to lowering the energy demand? I do not think so. Not without heavy economic incentives. I will try to explore everyday habits, theoretical savings and impact in a future post.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4" data-startfrom="310" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 309;"><span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>simplestats <span class="op">=</span> <span class="pp">require</span>(<span class="st">"simple-statistics@7"</span>)</span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a><span class="co">// Loading our data file</span></span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>days <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"/public/data/el-consumption-days-all.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span><span class="kw">true</span>})<span class="op">.</span><span class="fu">then</span>(raw <span class="kw">=&gt;</span> {</span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> lat <span class="op">=</span> <span class="fl">56.16</span><span class="op">,</span> long<span class="op">=</span><span class="fl">10.20</span></span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a>    <span class="co">//We want to simplify our objects and translate the values into appropriate formats.</span></span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a>    <span class="co">//We keep the date and the value</span></span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a>    raw <span class="op">=</span> raw<span class="op">.</span><span class="fu">filter</span>(o <span class="kw">=&gt;</span> {</span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> str <span class="op">=</span> o[<span class="st">"Fra_dato"</span>]<span class="op">.</span><span class="fu">substring</span>(<span class="dv">6</span><span class="op">,</span><span class="dv">10</span>)</span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> o[<span class="st">"Type"</span>] <span class="op">===</span> <span class="st">"Tidsserie"</span> <span class="op">&amp;&amp;</span> str <span class="op">!=</span> <span class="st">"2017"</span></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a>    raw <span class="op">=</span> raw<span class="op">.</span><span class="fu">map</span>(o <span class="kw">=&gt;</span> {</span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create a data object</span></span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> dstr <span class="op">=</span> o[<span class="st">"Fra_dato"</span>]<span class="op">.</span><span class="fu">replace</span>(<span class="st">" 00:00:00"</span><span class="op">,</span> <span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">"-"</span>)</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="vs">`</span><span class="sc">${</span>dstr[<span class="dv">2</span>]<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>dstr[<span class="dv">1</span>]<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>dstr[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Create object for date</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Including data on the hours of the day</span></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> sun <span class="op">=</span> SunCalc<span class="op">.</span><span class="fu">getTimes</span>(<span class="kw">new</span> <span class="bu">Date</span>(date)<span class="op">,</span> lat<span class="op">,</span>long)</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> daylight <span class="op">=</span> (sun<span class="op">.</span><span class="at">sunset</span> <span class="op">-</span> sun<span class="op">.</span><span class="at">sunrise</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">60</span></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> v <span class="op">=</span> <span class="kw">typeof</span> o[<span class="st">"Mængde"</span>] <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> <span class="pp">parseInt</span>(o[<span class="st">"Mængde"</span>]) <span class="op">:</span> o[<span class="st">"Mængde"</span>]</span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="dt">date</span><span class="op">:</span> date<span class="op">,</span> <span class="dt">kwhs</span><span class="op">:</span>v<span class="op">,</span> <span class="dt">daylight</span><span class="op">:</span>daylight}</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Sorting dates because the order is messy after conversion from object to array</span></span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a>    raw<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> {</span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a[<span class="st">"date"</span>] <span class="op">&gt;</span> b[<span class="st">"date"</span>]</span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> raw</span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"// Loading our data file\ndata = FileAttachment(\"/public/data/el-consumption-days-all.csv\").csv({typed:true}).then(raw => {\n    var lat = 56.16, long=10.20\n    \n    //We want to simplify our objects and translate the values into appropriate formats.\n    //We keep the date and the value\n    raw = raw.filter(o => {\n        var str = o[\"Fra_dato\"].substring(6,10)\n        return o[\"Type\"] === \"Tidsserie\" && str != \"2017\"\n    })\n\n    var days = {}\n\n    raw = raw.map(o => {\n        var dstr = o[\"Fra_dato\"].replace(\" 00:00:00\", \"\").split(\"-\")\n        \n        //Gonna remove the leap year. \n        if(dstr[1] === \"02\" && dstr[0] === \"29\"){\n            return\n        }\n\n        var date = new Date(`${2022}-${dstr[1]}-${dstr[0]}`)\n        \n        if(!days[date]){\n            //Create object for date\n            //Including data on the hours of the day\n            var sun = SunCalc.getTimes(new Date(date), lat,long)\n            var day_hs = sun.sunset.getHours() - sun.sunrise.getHours()\n            //day object to return\n            days[date] = {date: date, kwhs_min:100, kwhs_max:0, kwhs_values:[],kwhs_median:0,kwhs_q_lower:0, kwhs_q_upper:0, day_hs:day_hs}\n        }\n            \n\n        var v = typeof o[\"Mængde\"] == \"string\" ? parseInt(o[\"Mængde\"]) : o[\"Mængde\"]\n        //adding kwhs consumption to the value array and calculate min/max\n        days[date].kwhs_values.push(v)\n        days[date].kwhs_min = v < days[date].kwhs_min ? v : days[date].kwhs_min\n        days[date].kwhs_max = v > days[date].kwhs_max ? v : days[date].kwhs_max\n\n    })\n\n    //Convert days Object to Array\n    raw = Object.values(days)\n    //Sorting dates because the order is messy after conversion from object to array\n    raw.sort((a,b) => {\n        return a[\"date\"] > b[\"date\"]\n    })\n\n    //Calculating medians\n    raw = raw.map(o => {\n        o.kwhs_median = d3.median(o.kwhs_values)\n        o.kwhs_q_lower = d3.quantile(o.kwhs_values, 0.25)\n        o.kwhs_q_upper = d3.quantile(o.kwhs_values, 0.75)\n    \n        return o\n    })\n\n    return raw\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"//Chart appropriated from https://observablehq.com/@d3/radial-area-chart\nradial_chart = {\n\n    const width = 900\n    const height = 900\n    const innerRadius = width / 5\n    const outerRadius = width / 2\n\n    const xAxis = g => g\n        .attr(\"font-family\", \"sans-serif\")\n        .attr(\"font-size\", 12)\n        .call(g => g.selectAll(\"g\")\n            .data(x.ticks())\n            .join(\"g\")\n            .each((d, i) => d.id = DOM.uid(\"month\"))\n        .call(g => g.append(\"path\")\n            .attr(\"stroke\", \"#000\")\n            .attr(\"stroke-opacity\", 0.2)\n            .attr(\"d\", d => `\n              M${d3.pointRadial(x(d), innerRadius)}\n              L${d3.pointRadial(x(d), outerRadius)}\n            `))\n        .call(g => g.append(\"path\")\n            .attr(\"id\", d => d.id.id)\n            .datum(d => [d, d3.timeMonth.offset(d, 1)])\n            .attr(\"fill\", \"none\")\n            .attr(\"d\", ([a, b]) => `\n              M${d3.pointRadial(x(a), innerRadius-15)}\n              A${innerRadius},${innerRadius} 0,0,1 ${d3.pointRadial(x(b), innerRadius-15)}\n            `))\n        .call(g => g.append(\"text\")\n          .append(\"textPath\")\n            .attr(\"startOffset\", 2)\n            .attr(\"xlink:href\", d => d.id.href)\n            .text(d3.timeFormat(\"%B\"))))\n    \n    const yAxis = g => g\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"font-family\", \"sans-serif\")\n        .attr(\"font-size\", 12)\n        .call(g => g.append(\"circle\")\n                .attr(\"stroke\", \"#000\")\n                .attr(\"fill\", \"none\")\n                .attr(\"stroke-opacity\", 0.2)\n                .attr(\"r\", y(0)))\n        .call(g => g.selectAll(\"g\")\n            .data(y.ticks().reverse())\n            .join(\"g\")\n            .attr(\"fill\", \"none\")\n            .call(g => g.append(\"circle\")\n                .attr(\"stroke\", \"#000\")\n                .attr(\"stroke-opacity\", 0.2)\n                .attr(\"r\", y))\n            .call(g => g.append(\"text\")\n                .attr(\"y\", d => -y(d))\n                .attr(\"dy\", \"0.5em\")\n                .attr(\"stroke\", \"#fff\")\n                .attr(\"stroke-width\", 5)\n                .text((x, i) => `${x.toFixed(0)}${i ? \"\" : \" kwhs\"}`)\n                .clone(true)\n                .attr(\"y\", d => y(d))\n                .selectAll(function() {return [this, this.previousSibling]; })\n                .clone(true)\n                .attr(\"fill\", \"currentColor\")\n                .attr(\"stroke\", \"none\")))\n        \n    const x = d3.scaleTime()\n        .domain([new Date(2022, 0, 1), new Date(2022, 11, 31)])\n        .range([0, 2 * Math.PI])\n    \n    const y = d3.scaleLinear()\n        .domain([d3.min(data, d => d.kwhs_min), d3.max(data, d => d.kwhs_max)+2])\n        .range([innerRadius, outerRadius])\n\n    const area = d3.areaRadial()\n        .curve(d3.curveBasis)\n        .angle(d => x(d.date))\n\n    const line = d3.lineRadial()\n        .curve(d3.curveBasis)\n        .angle(d => x(d.date))\n\n    const svg = d3.create(\"svg\")\n        .attr(\"viewBox\", [-width / 2, -height / 2, width, height])\n        .attr(\"stroke-linejoin\", \"round\")\n        .attr(\"stroke-linecap\", \"round\");\n\n    svg.append(\"path\")\n        .attr(\"fill\", \"lightyellow\")\n        .attr(\"d\", area\n            .innerRadius(d => y(0))\n            .outerRadius(d => y(d.day_hs))\n        (data))\n\n    svg.append(\"path\")\n        .attr(\"fill\", \"lightsteelblue\")\n        .attr(\"fill-opacity\", 1)\n        .attr(\"d\", area\n            .innerRadius(d => y(d.kwhs_min))\n            .outerRadius(d => y(d.kwhs_max))\n        (data));\n\n    svg.append(\"path\")\n        .attr(\"fill\", \"steelblue\")\n        .attr(\"fill-opacity\", 1)\n        .attr(\"d\", area\n            .innerRadius(d => y(d.kwhs_q_lower))\n            .outerRadius(d => y(d.kwhs_q_upper))\n        (data));\n    \n    svg.append(\"path\")\n        .attr(\"fill\", \"none\")\n        .attr(\"class\", \"median\")\n        .attr(\"stroke\", \"darkblue\")\n        .attr(\"stroke-width\", 1)\n        .attr(\"d\", line\n            .radius(d => y(d.kwhs_median))\n        (data));\n    \n    svg.append(\"g\")\n        .call(xAxis);\n    \n    svg.append(\"g\")\n        .call(yAxis);\n\n    var legend = svg.append(\"g\").attr(\"transform\", \"translate(\"+(-width/2)+\",\" + (-height/2) + \")\")\n    \n    legend.attr(\"font-family\", \"sans-serif\")\n            .attr(\"font-size\", 16)\n    \n    legend.append(\"rect\")\n            .attr(\"x\",2)\n            .attr(\"y\",0)\n            .attr(\"width\", 20)\n            .attr(\"height\", 20)\n            .attr(\"fill\", \"lightsteelblue\")\n\n    legend.append(\"text\")\n            .attr(\"x\", 27)\n            .attr(\"y\", 0)\n            .attr(\"dy\", \"1em\")\n            .text(\"Minimum and maximum consumption 2018 - 2022\")\n    \n    legend.append(\"rect\")\n            .attr(\"x\",2)\n            .attr(\"y\",25)\n            .attr(\"width\", 20)\n            .attr(\"height\", 20)\n            .attr(\"fill\", \"steelblue\")\n\n    legend.append(\"text\")\n            .attr(\"x\", 27)\n            .attr(\"y\", 25)\n            .attr(\"dy\", \"1em\")\n            .text(\"Upper and lower quartiles consumtion (kwhs)\")\n\n    legend.append(\"rect\")\n            .attr(\"x\",2)\n            .attr(\"y\",50)\n            .attr(\"width\", 20)\n            .attr(\"height\", 20)\n            .attr(\"fill\", \"darkblue\")\n\n    legend.append(\"text\")\n            .attr(\"x\", 27)\n            .attr(\"y\", 50)\n            .attr(\"dy\", \"1em\")\n            .text(\"Median consumption (kwhs)\")\n    \n    legend.append(\"rect\")\n            .attr(\"x\",2.5)\n            .attr(\"y\",75)\n            .attr(\"width\", 19)\n            .attr(\"height\", 19)\n            .attr(\"stroke\",\"grey\")\n            .attr(\"fill\", \"lightyellow\")\n\n    legend.append(\"text\")\n            .attr(\"x\", 27)\n            .attr(\"y\", 75)\n            .attr(\"dy\", \"1em\")\n            .text(\"Daylight hours\")\n\n    return svg.node()\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"correlation_coeffecient = {\n\n    const kwhs_array = days.map(d =>{\n        return d.kwhs\n    })\n\n    const daylight_array = days.map( d =>{\n        return d.daylight\n    })\n\n    const correlation = simplestats.sampleCorrelation(kwhs_array,daylight_array)\n    return correlation\n}\n\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"simplestats = require(\"simple-statistics@7\")\n// Loading our data file\ndays = FileAttachment(\"/public/data/el-consumption-days-all.csv\").csv({typed:true}).then(raw => {\n    var lat = 56.16, long=10.20\n    \n    //We want to simplify our objects and translate the values into appropriate formats.\n    //We keep the date and the value\n    raw = raw.filter(o => {\n        var str = o[\"Fra_dato\"].substring(6,10)\n        return o[\"Type\"] === \"Tidsserie\" && str != \"2017\"\n    })\n\n    raw = raw.map(o => {\n        // Create a data object\n        var dstr = o[\"Fra_dato\"].replace(\" 00:00:00\", \"\").split(\"-\")\n        var date = new Date(`${dstr[2]}-${dstr[1]}-${dstr[0]}`)\n      \n        //Create object for date\n            //Including data on the hours of the day\n        var sun = SunCalc.getTimes(new Date(date), lat,long)\n        var daylight = (sun.sunset - sun.sunrise) / 1000 / 60\n\n        var v = typeof o[\"Mængde\"] == \"string\" ? parseInt(o[\"Mængde\"]) : o[\"Mængde\"]\n\n        return {date: date, kwhs:v, daylight:daylight}\n    \n    })\n\n    //Sorting dates because the order is messy after conversion from object to array\n    raw.sort((a,b) => {\n        return a[\"date\"] > b[\"date\"]\n    })\n\n    return raw\n})\n"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../notes";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://hci.social/web/@heenrik">
      <i class="bi bi-mastodon" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:korsgaard@protonmail.com?Subject=I%20saw%20your%20website...">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/henrikkorsgaard">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>